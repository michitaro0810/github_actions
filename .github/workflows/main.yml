name: Node.js CI/CD

on:
  push:
    branches:
      - main # ワークフローがmainブランチにプッシュされたときに実行

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2 # リポジトリのコードをチェックアウト

    - name: Set up Node.js
      uses: actions/setup-node@v2 # Node.jsをセットアップ
      with:
        node-version: '14' # 使用するNode.jsのバージョン

    - name: Install dependencies
      run: npm install # プロジェクトの依存関係をインストール

    - name: Run tests
      run: npm test # テストを実行

    - name: Deploy to production
      if: success() # テストが成功した場合のみ実行
      run: |
        # デプロイスクリプトやコマンドをここに記述

name: Commit Message Lint

on:
  pull_request:
    types:
      - opened
      - synchronize

jobs:
  lint-commit-messages:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 14

      - name: Install dependencies
        run: npm install

      - name: Lint commit messages
        run: npm run lint:commit-messages

      - name: Save lint results
        run: echo ${{ steps.lint-commit-messages.outputs.lint-results }} > lint-results.txt

      - name: Comment on pull request
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            const results = fs.readFileSync('lint-results.txt', 'utf8');
            const { owner, repo, number } = context.issue;

            github.rest.issues.createComment({
              owner,
              repo,
              issue_number: number,
              body: `Commit Message Lint Results:\n\`\`\`${results}\n\`\`\``,
            });
